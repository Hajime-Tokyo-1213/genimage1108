# 改修仕様書 8: PromptMaker コンポーネントの分離

## 目的
`ImageGenerator.jsx`内の`PromptMaker`コンポーネント（1,400行超）を独立したファイルに分離し、保守性を向上させる。

## 背景
- `PromptMaker`コンポーネントが`ImageGenerator.jsx`内に定義されており、ファイルが巨大化している
- `PromptMaker`は独立した機能として扱えるため、分離が可能
- 分離により、テストと保守が容易になる

## 実施内容

### 1. コンポーネントファイルの作成
- **ファイル**: `src/components/PromptMaker.tsx` を新規作成
- **内容**:
  - `PromptMaker`コンポーネントを独立したファイルに移動
  - 必要な型定義を追加
  - 必要なインポートを追加

### 2. カスタムフックの作成（オプション）
- **ファイル**: `src/hooks/usePromptMaker.ts` を新規作成（必要に応じて）
- **内容**:
  - `PromptMaker`の状態管理ロジックを抽出

### 3. ImageGenerator.jsx の更新
- `PromptMaker`コンポーネントの定義を削除
- `PromptMaker`をインポートして使用

## 実装詳細

### `src/components/PromptMaker.tsx` の構造
```typescript
import React, { useState, useCallback, useEffect } from 'react';
import { useAuth } from '../contexts/AuthContext';
import { supabase } from '../lib/supabaseClient';
import { requireSession } from '../lib/supabaseClient';
import { handleError, logError } from '../utils/errorHandler';
import { Style } from '../types';

interface PromptMakerProps {
  onStyleCreated?: (style: Style) => void;
}

const PromptMaker: React.FC<PromptMakerProps> = ({ onStyleCreated = () => {} }) => {
  const { user } = useAuth();
  // ... 既存のstate定義をそのまま移動 ...
  
  // ... 既存の関数定義をそのまま移動 ...
  
  // ... 既存のJSXをそのまま移動 ...
  
  return (
    // ... 既存のJSX ...
  );
};

export default PromptMaker;
```

### `src/ImageGenerator.jsx` の更新例
```javascript
// PromptMakerコンポーネントの定義を削除
import PromptMaker from './components/PromptMaker';

const ImageGenerator = () => {
  // ... 既存のコード ...
  
  // PromptMakerの使用箇所は変更なし
  {appMode === 'prompt' && (
    <PromptMaker onStyleCreated={handleStyleCreated} />
  )}
  
  // ... 残りのコンポーネント ...
};
```

## 実装手順

### ステップ1: PromptMakerコンポーネントの抽出
1. `ImageGenerator.jsx`から`PromptMaker`コンポーネントの定義をコピー
2. `src/components/PromptMaker.tsx`を作成
3. 必要なインポートを追加
4. 型定義を追加（可能な範囲で）

### ステップ2: ImageGenerator.jsxの更新
1. `PromptMaker`コンポーネントの定義を削除
2. `PromptMaker`をインポート
3. 使用箇所は変更なし

### ステップ3: 動作確認
1. ビルドエラーがないことを確認
2. プロンプトモードが正常に動作することを確認
3. スタイル作成機能が正常に動作することを確認

## テスト要件
- `PromptMaker`コンポーネントが独立して動作することを確認
- `ImageGenerator`から`PromptMaker`が正しく呼び出されることを確認
- 既存の機能が壊れていないことを確認

## 影響範囲
- `src/ImageGenerator.jsx`（`PromptMaker`コンポーネントの定義を削除）
- 新規ファイル: `src/components/PromptMaker.tsx`
- オプション: `src/hooks/usePromptMaker.ts`（必要に応じて）

## 完了条件
- [ ] `src/components/PromptMaker.tsx`が作成され、`PromptMaker`コンポーネントが実装されている
- [ ] `ImageGenerator.jsx`から`PromptMaker`コンポーネントの定義が削除されている
- [ ] `ImageGenerator.jsx`が`PromptMaker`をインポートして使用している
- [ ] ビルドエラーがない
- [ ] プロンプトモードが正常に動作することを確認
- [ ] スタイル作成機能が正常に動作することを確認

## 注意事項
- 既存の機能を壊さないよう、慎重に分離を行う
- `PromptMaker`の状態管理が`ImageGenerator`と独立していることを確認する
- プロップスの受け渡しが正しく動作することを確認する
- 必要に応じて、`PromptMaker`の状態管理をカスタムフックに抽出することを検討する（次回以降の改修で実施）

## 次のステップ（参考）
- `PromptMaker`コンポーネントの状態管理をカスタムフックに抽出
- `PromptMaker`の各機能をさらに細かく分離
- TypeScript化の完全な実装

