# アプリ動作確認ガイド（ステップバイステップ）

## 📋 確認前の準備

### 1. 環境変数の確認
- `.env`ファイルに以下が設定されているか確認：
  ```env
  VITE_GEMINI_API_KEY=your_key_here
  VITE_OPENAI_API_KEY=your_key_here
  VITE_SUPABASE_URL=https://xxxxx.supabase.co
  VITE_SUPABASE_ANON_KEY=your_key_here
  ```

### 2. アプリの起動
```bash
npm run dev
```

### 3. ブラウザで開く
- `http://localhost:3000` または表示されたURLにアクセス

### 4. 開発者ツールを開く
- `F12` キーを押す
- **Console** タブを開く
- エラーメッセージがないか確認

---

## 🔍 ステップ1: ログイン・認証の確認

### 確認項目
- [ ] ログインページが表示される
- [ ] 会員登録ができる
- [ ] ログインができる
- [ ] ログイン後、画像生成ページに遷移する

### 手順
1. **会員登録**
   - 「会員登録はこちら」をクリック
   - ユーザー名、メールアドレス、パスワードを入力
   - 「登録」をクリック
   - ✅ 成功: ログイン画面に戻る、または自動ログインされる

2. **ログイン**
   - メールアドレスとパスワードを入力
   - 「ログイン」をクリック
   - ✅ 成功: 画像生成ページに遷移し、「ようこそ、[ユーザー名]さん」と表示される

### 確認ポイント
- コンソールにエラーが表示されていないか
- 「Auth session missing!」などのエラーがないか

---

## 🔍 ステップ2: 初期データ読み込みの確認

### 確認項目
- [ ] スタイルライブラリが読み込まれる
- [ ] 画像履歴が読み込まれる（既存データがある場合）
- [ ] 無限ループが発生していない

### 手順
1. **ログイン後の状態を確認**
   - ページが読み込まれたら、コンソールを確認
   - ✅ 成功: エラーが1回だけ表示される（または表示されない）
   - ❌ 失敗: 同じエラーが繰り返し表示される → 無限ループの可能性

2. **左サイドバー（スタイルライブラリ）を確認**
   - 「🎨 スタイルライブラリ」セクションを確認
   - ✅ 成功: デフォルトスタイル（和風アート、未来都市、ファンタジー、水彩画）が表示される
   - ✅ または: Supabaseから保存済みスタイルが読み込まれる

3. **右サイドバー（画像履歴）を確認**
   - 「🖼️ 生成画像一覧」セクションを確認
   - ✅ 成功: 既存の画像があれば表示される
   - ✅ または: 「まだ画像が生成されていません」と表示される

### 確認ポイント
- コンソールに「履歴の読み込みに失敗しました」が表示されないか
- コンソールに「スタイルの読み込みに失敗しました」が表示されないか
- リクエストが無限に繰り返されていないか

---

## 🔍 ステップ3: 画像生成機能の確認

### 確認項目
- [ ] 新規画像生成ができる
- [ ] 生成された画像が表示される
- [ ] 画像がSupabaseに保存される

### 手順

#### 3-1. 基本的な画像生成
1. **プロンプトを入力**
   - 中央の「プロンプトを直接入力（オプション）」欄に、簡単なプロンプトを入力
   - 例: `美しい夕日の風景`

2. **「画像を生成」ボタンをクリック**
   - ✅ 成功: 「生成中...」と表示され、ローディング表示が出る
   - ✅ 成功: 数秒後に画像が表示される
   - ❌ 失敗: エラーメッセージが表示される

3. **生成された画像を確認**
   - ✅ 成功: 画像が中央に表示される
   - ✅ 成功: 「💾 画像をダウンロード」と「🔄 再生成」ボタンが表示される

#### 3-2. YAML形式での画像生成
1. **YAML形式の入力欄を使用**
   - 「スタイル・人物・背景（YAML形式）」欄に以下を入力：
   ```json
   {
     "style": "photorealistic, vibrant colors",
     "person": "若い女性、長い髪、笑顔",
     "background": "夕日の海辺、雲一つない空"
   }
   ```

2. **「生成プロンプト」欄を確認**
   - ✅ 成功: YAMLから生成されたプロンプトが表示される

3. **「画像を生成」ボタンをクリック**
   - ✅ 成功: 画像が生成される

#### 3-3. スタイルライブラリを使用した画像生成
1. **スタイルを選択**
   - 左サイドバーのスタイル（例: 「和風アート」）をクリック
   - ✅ 成功: スタイルが展開され、「適用」ボタンが表示される

2. **「適用」ボタンをクリック**
   - ✅ 成功: プロンプト欄にスタイルのプロンプトが追加される

3. **画像を生成**
   - 「画像を生成」ボタンをクリック
   - ✅ 成功: スタイルが適用された画像が生成される

### 確認ポイント
- コンソールに「画像生成開始:」のログが表示される
- コンソールに「画像生成成功:」のログが表示される
- エラーメッセージが表示されない

---

## 🔍 ステップ4: データ保存の確認

### 確認項目
- [ ] 生成された画像がSupabaseに保存される
- [ ] ページをリロードしても画像が表示される

### 手順

1. **画像を生成**
   - 上記のステップ3で画像を生成

2. **ブラウザのコンソールを確認**
   - ✅ 成功: エラーメッセージが表示されない
   - ❌ 失敗: 「画像履歴の保存に失敗しました」が表示される

3. **Supabaseダッシュボードで確認**
   - Supabaseダッシュボード → **Table Editor** → `image_histories` テーブル
   - ✅ 成功: 生成した画像のレコードが表示される
   - ✅ 成功: `thumbnail_url` カラムにデータが入っている
   - ✅ 成功: `full_image_url` カラムにデータが入っている（マイグレーション実行後）

4. **ページをリロード**
   - `F5` キーを押す、またはブラウザのリロードボタンをクリック
   - ✅ 成功: 右サイドバーに生成した画像が表示される
   - ✅ 成功: 画像をクリックすると表示される

### 確認ポイント
- コンソールに「full_image_urlカラムが存在しません」という警告が表示されないか
- データが正しく保存されているか

---

## 🔍 ステップ5: 画像編集機能の確認

### 確認項目
- [ ] 画像をアップロードできる
- [ ] アップロードした画像を編集できる

### 手順

1. **編集モードに切り替え**
   - 「画像を修正」ラジオボタンを選択
   - ✅ 成功: アップロード欄が強調表示される

2. **画像をアップロード**
   - 「📷 画像をアップロード（編集用）」をクリック
   - 画像ファイルを選択
   - ✅ 成功: 「✓ 画像がアップロードされました」と表示される

3. **プロンプトを入力**
   - 例: `この画像を油絵風にして`

4. **画像を生成**
   - 「画像を生成」ボタンをクリック
   - ✅ 成功: アップロードした画像を編集した画像が生成される

---

## 🔍 ステップ6: 画像履歴機能の確認

### 確認項目
- [ ] 生成した画像が履歴に表示される
- [ ] 画像のタイトルを編集できる
- [ ] 画像を削除できる
- [ ] 画像をダウンロードできる

### 手順

1. **履歴一覧を確認**
   - 右サイドバーの「🖼️ 生成画像一覧」を確認
   - ✅ 成功: 生成した画像がサムネイルで表示される

2. **タイトルを編集**
   - 履歴の画像のタイトル部分をクリック
   - ✅ 成功: 入力欄が表示される
   - タイトルを入力してEnterキーを押す
   - ✅ 成功: タイトルが保存される

3. **画像をクリック**
   - 履歴の画像をクリック
   - ✅ 成功: クイックルックモーダルが表示される
   - ✅ 成功: フルサイズ画像が表示される

4. **画像をダウンロード**
   - 履歴の画像の「💾」ボタンをクリック
   - ✅ 成功: 画像がダウンロードされる

5. **画像を削除**
   - 履歴の画像の「×」ボタンをクリック
   - 確認ダイアログで「OK」をクリック
   - ✅ 成功: 画像が削除される

---

## 🔍 ステップ7: スタイルライブラリ機能の確認

### 確認項目
- [ ] 新しいスタイルを追加できる
- [ ] スタイルを編集できる
- [ ] スタイルを削除できる

### 手順

1. **スタイルを追加**
   - 左サイドバーの「+ 追加」ボタンをクリック
   - スタイル名とプロンプトを入力
   - 「保存」ボタンをクリック
   - ✅ 成功: 新しいスタイルがリストに追加される

2. **スタイルを編集**
   - スタイルの「✏️」ボタンをクリック
   - ✅ 成功: 編集フォームが表示される
   - スタイル名とプロンプトを編集
   - 「更新」ボタンをクリック
   - ✅ 成功: スタイルが更新される

3. **スタイルを削除**
   - スタイルの「×」ボタンをクリック
   - ✅ 成功: スタイルが削除される

---

## 🔍 ステップ8: プロンプトモードの確認

### 確認項目
- [ ] プロンプトモードに切り替えられる
- [ ] プロンプトをYAMLに変換できる
- [ ] テンプレートを保存できる

### 手順

1. **プロンプトモードに切り替え**
   - 上部の「📝 プロンプトモード」タブをクリック
   - ✅ 成功: プロンプトメーカー画面が表示される

2. **プロンプトをYAMLに変換**
   - 「マスタープロンプト」欄にプロンプトを入力
   - 例: `A beautiful sunset over the ocean, color: vibrant orange and pink, style: photorealistic`
   - 「テンプレート生成」ボタンをクリック
   - ✅ 成功: YAML構造が表示される

3. **テンプレートを保存**
   - テンプレート名を入力
   - 「保存」ボタンをクリック
   - ✅ 成功: テンプレートが左サイドバーに表示される

---

## 🐛 トラブルシューティング

### エラーが発生した場合

1. **コンソールを確認**
   - `F12` → **Console** タブ
   - エラーメッセージを確認

2. **よくあるエラーと対処法**

   | エラー | 原因 | 対処法 |
   |--------|------|--------|
   | `VITE_SUPABASE_URL is not defined` | 環境変数が設定されていない | `.env`ファイルを確認 |
   | `Failed to fetch` | Supabase接続エラー | `SUPABASE_CONNECTION_CHECK.md`を参照 |
   | `column full_image_url does not exist` | マイグレーション未実行 | `supabase-setup.md`の手順を実行 |
   | `Auth session missing!` | ログインが必要 | ログインし直す |
   | 無限ループ | useEffectの依存配列の問題 | ページをリロード |

3. **ネットワークタブを確認**
   - `F12` → **Network** タブ
   - Supabaseへのリクエストが失敗していないか確認
   - ステータスコードが200以外の場合は、エラー内容を確認

---

## ✅ 確認チェックリスト

### 基本機能
- [ ] ログイン・会員登録ができる
- [ ] 画像生成ができる
- [ ] 画像がSupabaseに保存される
- [ ] ページリロード後も画像が表示される

### 高度な機能
- [ ] 画像編集ができる
- [ ] スタイルライブラリが使える
- [ ] 画像履歴が表示される
- [ ] タイトル編集ができる
- [ ] プロンプトモードが使える

### データ整合性
- [ ] 無限ループが発生していない
- [ ] エラーが適切にハンドリングされている
- [ ] データが正しく保存・読み込まれている

---

## 📝 確認結果の記録

各ステップで以下を記録してください：

1. **成功/失敗**
2. **発生したエラー（あれば）**
3. **スクリーンショット（必要に応じて）**
4. **改善点や気づいたこと**

この情報は、問題の特定と修正に役立ちます。

