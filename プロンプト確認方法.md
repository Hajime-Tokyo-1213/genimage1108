# プロンプト確認方法

## プロンプトを確認できる場所

### 1. ソースコード内の確認

プロンプト解析のロジックは以下のファイルにあります：

**ファイル**: `src/ImageGenerator.jsx`

**関数**: `parsePromptToYaml` (約2228行目から)

この関数内で以下を確認できます：
- `systemPrompt`: OpenAI APIに送信するシステムプロンプト（解析の指示）
- `userPrompt`: 実際に解析するプロンプト（ユーザーが入力したマスタープロンプト）
- `exampleOutput`: Few-shot learningの例

### 2. ブラウザの開発者ツールで確認

#### 開発環境（DEVモード）の場合

1. ブラウザの開発者ツールを開く（F12 または 右クリック → 検証）
2. **Console** タブを開く
3. プロンプトモードで「テンプレート生成」を実行すると、以下のログが表示されます：
   - `📝 解析対象プロンプト:` - 実際に解析されるプロンプト
   - `🤖 使用モデル:` - 使用されているOpenAIモデル
   - `✅ 解析結果:` - 解析されたJSON構造
   - `📊 抽出されたセクション:` - 抽出されたセクション名のリスト

#### 本番環境の場合

開発環境でない場合は、コンソールログは表示されません。確認するには：

1. ブラウザの開発者ツールを開く
2. **Network** タブを開く
3. プロンプトモードで「テンプレート生成」を実行
4. `chat/completions` というリクエストを探す
5. リクエストをクリックして、**Payload** タブを確認
   - `messages` 配列内に、送信されたプロンプトが含まれています

### 3. 実際に送信されるプロンプトの構造

OpenAI APIに送信されるメッセージの構造：

```json
{
  "model": "gpt-4o-mini",
  "messages": [
    {
      "role": "system",
      "content": "システムプロンプト（解析の指示）"
    },
    {
      "role": "user",
      "content": "例として、以下のような詳細な構造化を期待しています: ..."
    },
    {
      "role": "assistant",
      "content": "例の出力（Few-shot learning）"
    },
    {
      "role": "user",
      "content": "実際に解析するプロンプト（ユーザーが入力したマスタープロンプト）"
    }
  ],
  "temperature": 0.2,
  "response_format": { "type": "json_object" }
}
```

## プロンプトのカスタマイズ方法

### systemPromptの変更

`src/ImageGenerator.jsx` の `parsePromptToYaml` 関数内（約2238行目）の `systemPrompt` 変数を編集することで、解析の指示を変更できます。

### モデルの変更

`.env` ファイルに以下を追加することで、使用するモデルを変更できます：

```env
VITE_OPENAI_MODEL=gpt-4o
```

利用可能なモデル：
- `gpt-4o-mini` (デフォルト、コスト効率重視)
- `gpt-4o` (高精度、コスト高め)
- `gpt-4-turbo` (高精度)
- `gpt-3.5-turbo` (低コスト)

### 温度パラメータの変更

`parsePromptToYaml` 関数内（約2450行目）の `temperature` 値を変更できます：

- `0.0-0.3`: 一貫性重視（構造化タスクに推奨）
- `0.4-0.7`: バランス
- `0.8-1.0`: 創造性重視

## トラブルシューティング

### プロンプトが正しく解析されない場合

1. **コンソールログを確認**
   - 開発環境で、実際に送信されているプロンプトを確認
   - 解析結果を確認し、どのセクションが抽出されているか確認

2. **systemPromptを確認**
   - `src/ImageGenerator.jsx` の `systemPrompt` が期待する指示を含んでいるか確認

3. **モデルを変更**
   - `gpt-4o-mini` で精度が不十分な場合、`gpt-4o` に変更してみる

4. **Few-shot learningの例を確認**
   - `exampleOutput` が期待する出力形式を示しているか確認

## 柔軟な構造化について

現在の実装では、プロンプトの内容に応じて柔軟にセクションを抽出できるようになっています：

- プロンプト内のセクション名（例: "ATTIRE POLICY", "HAIR TONE LOCK"）を認識
- プロンプトの内容に基づいて、適切なセクション名と構造を自動的に決定
- 固定のセクションリストに縛られず、新しい種類の情報にも対応

これにより、毎回異なるプロンプト構造にも柔軟に対応できます。

